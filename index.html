<!DOCTYPE html>
<html lang="en" id="htmlRoot">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#2c1a0e">
    <meta name="description" content="SAMARTHAA-LEGAL â€” AI-powered Indian Legal Assistant for Contract Drafting, Case Research and Legal Opinions">
    <title>SAMARTHAA-LEGAL : The Indian Legal AI Assistant</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/chat.css">

    <link rel="icon" type="image/png" href="assets/images/favicon.png">
</head>
<body>
 
    <!-- LOGIN -->
    <div id="loginSection" class="login-section">
        <h2 id="loginTitle">&#x1F510; Login Required</h2>

        <!-- Country / locale selector -->
        <div style="margin-bottom:16px;">
            <label id="countryLabel" for="countrySelect" style="display:block;font-size:0.82rem;font-weight:600;margin-bottom:8px;opacity:0.75;">Country / Jurisdiction</label>
            <div style="display:flex;gap:8px;">
                <button class="locale-btn active" id="localeIN" onclick="if(window.setAppLocale) setAppLocale('en-IN')" title="India â€” English">
                    ðŸ‡®ðŸ‡³ India
                </button>
                <button class="locale-btn" id="localeJP" onclick="if(window.setAppLocale) setAppLocale('ja-JP')" title="Japan â€” Japanese">
                    ðŸ‡¯ðŸ‡µ æ—¥æœ¬
                </button>
            </div>
        </div>

        <input type="email"    id="loginEmail"    placeholder="Email" autocomplete="email">
        <input type="password" id="loginPassword" placeholder="Password" autocomplete="current-password">
        <button id="loginBtn">Login</button>
        <div id="loginError" role="alert"></div>
    </div>

    <!-- HEADER -->
    <header>
        <div class="header-content">
            <h1>&#x2696;&#xFE0F; SAMARTHAA-LEGAL</h1>
            <p class="tagline" id="appSubtitle">Contract Drafting &bull; Case Research &bull; Legal Opinions</p>
        </div>
        <div style="display:flex;align-items:center;gap:10px;">
            <span id="localeFlag" style="background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.3);color:#fff;padding:6px 12px;border-radius:20px;font-size:0.85rem;font-weight:600;">ðŸ‡®ðŸ‡³ India</span>
            <button id="logoutBtn">Logout</button>
        </div>
    </header>

    <!-- MAIN APP -->
    <div class="container" id="mainApp" style="display:none;">

        <div class="info-box">
            <h3 id="howToTitle">&#x1F4CB; How to Use</h3>
            <ul>
                <li><strong>Contract Drafting:</strong> Select contract type and fill in key terms &mdash; tap &#x1F3A4; to speak any field.</li>
                <li><strong>Case Research:</strong> Enter legal issue and context &mdash; voice input on every field.</li>
                <li><strong>Legal Opinion:</strong> Describe your matter, type or speak, then &#x1F50A; listen to the result via ElevenLabs.</li>
            </ul>
        </div>

        <h2 class="section-title" id="selectService">Select Legal Service</h2>

        <div class="mode-selector">
            <div class="mode-card" data-mode="contract">
                <h3 id="modeContractTitle">&#x1F4DD; Contract Drafting</h3>
                <p id="modeContractDesc">Generate sale deeds, lease agreements, NDAs, employment contracts and more. Voice input enabled.</p>
            </div>
            <div class="mode-card" data-mode="research">
                <h3 id="modeResearchTitle">&#x1F50D; Case Research</h3>
                <p id="modeResearchDesc">Research Indian case law and precedents. Speak your query hands-free and get results read aloud.</p>
            </div>
            <div class="mode-card" data-mode="opinion">
                <h3 id="modeOpinionTitle">&#x2696;&#xFE0F; Legal Opinion</h3>
                <p id="modeOpinionDesc">Detailed legal opinions with full voice interaction &mdash; speak your facts, listen to the analysis.</p>
            </div>
        </div>

        <!-- INPUT SECTION -->
        <div class="config-section" id="inputSection" style="display:none;">
            <h2 id="sectionTitle">Legal Query</h2>

            <!-- CONTRACT FIELDS -->
            <div id="contractFields" class="mode-fields" style="display:none;">
                <div class="input-group">
                    <label for="contractType" id="contractTypeLabel">Contract Type</label>
                    <select id="contractType">
                        <option value="">Select Contract Type</option>
                        <option value="Sale Deed">Sale Deed</option>
                        <option value="Lease Agreement">Lease Agreement</option>
                        <option value="Employment Contract">Employment Contract</option>
                        <option value="Service Agreement">Service Agreement</option>
                        <option value="Partnership Deed">Partnership Deed</option>
                        <option value="Non-Disclosure Agreement">Non-Disclosure Agreement (NDA)</option>
                        <option value="Memorandum of Understanding">Memorandum of Understanding (MOU)</option>
                        <option value="Loan Agreement">Loan Agreement</option>
                        <option value="License Agreement">License Agreement</option>
                        <option value="Franchise Agreement">Franchise Agreement</option>
                        <option value="Other">Other (specify in details)</option>
                    </select>
                </div>
                <div class="input-group voice-panel visible" id="voicePanel_contract">
                    <div class="field-label-row">
                        <label for="contractDetails" id="contractDetailsLabel">Contract Details &amp; Key Terms</label>
                        <button class="btn-mic-inline" id="micContractDetails">&#x1F3A4; Speak</button>
                    </div>
                    <input type="text" id="contractDetails"
                           placeholder="Parties, obligations, payment terms, duration &mdash; or tap mic">
                    <div class="voice-status" id="micContractDetails_status" aria-live="polite"></div>
                </div>
            </div>

            <!-- RESEARCH FIELDS -->
            <div id="researchFields" class="mode-fields" style="display:none;">
                <div class="input-group voice-panel visible" id="voicePanel_research">
                    <div class="field-label-row">
                        <label for="legalIssue" id="legalIssueLabel">Legal Issue / Topic</label>
                        <button class="btn-mic-inline" id="micLegalIssue">&#x1F3A4; Speak</button>
                    </div>
                    <input type="text" id="legalIssue"
                           placeholder="e.g., Anticipatory Bail under Section 438 CrPC">
                    <div class="voice-status" id="micLegalIssue_status" aria-live="polite"></div>

                    <div style="margin-top:16px;">
                        <div class="field-label-row">
                            <label for="researchQuery" id="researchQueryLabel">Research Query &amp; Context</label>
                            <button class="btn-mic-inline" id="micResearchQuery">&#x1F3A4; Speak</button>
                        </div>
                        <textarea id="researchQuery"
                                  placeholder="Describe the legal issue and context..."></textarea>
                        <div class="voice-status" id="micResearchQuery_status" aria-live="polite"></div>
                    </div>
                </div>

                <div class="input-group">
                    <label for="jurisdiction" id="jurisdictionLabel">Preferred Jurisdiction</label>
                    <select id="jurisdiction">
                        <option value="All">All Indian Courts</option>
                        <option value="Supreme Court">Supreme Court of India</option>
                        <option value="Delhi High Court">Delhi High Court</option>
                        <option value="Bombay High Court">Bombay High Court</option>
                        <option value="Madras High Court">Madras High Court</option>
                        <option value="Karnataka High Court">Karnataka High Court</option>
                        <option value="Calcutta High Court">Calcutta High Court</option>
                        <option value="Other">Other High Courts</option>
                    </select>
                </div>
            </div>

            <!-- OPINION FIELDS -->
            <div id="opinionFields" class="mode-fields" style="display:none;">
                <div class="input-group voice-panel visible" id="voicePanel_opinion">
                    <div class="field-label-row">
                        <label for="opinionTopic" id="opinionTopicLabel">Legal Matter / Question</label>
                        <button class="btn-mic-inline" id="micOpinionTopic">&#x1F3A4; Speak</button>
                    </div>
                    <input type="text" id="opinionTopic"
                           placeholder="e.g., Enforceability of Oral Agreement for Property Sale">
                    <div class="voice-status" id="micOpinionTopic_status" aria-live="polite"></div>

                    <div style="margin-top:16px;">
                        <div class="field-label-row">
                            <label for="opinionQuery" id="opinionQueryLabel">Detailed Query &amp; Facts</label>
                            <button class="btn-mic-inline" id="micOpinionQuery">&#x1F3A4; Speak</button>
                        </div>
                        <textarea id="opinionQuery"
                                  placeholder="Provide comprehensive details, or tap mic to speak your facts..."></textarea>
                        <div class="voice-status" id="micOpinionQuery_status" aria-live="polite"></div>
                    </div>

                    <div style="margin-top:16px;">
                        <label for="applicableLawsInput" id="applicableLawsLabel" style="display:block;font-size:0.82rem;font-weight:600;color:#5a4e38;text-transform:uppercase;letter-spacing:0.04em;margin-bottom:8px;">Applicable Laws (if known)</label>
                        <input type="text" id="applicableLawsInput"
                               style="width:100%;padding:12px 16px;font-size:16px;border:1.5px solid #d4c9a8;border-radius:8px;"
                               placeholder="e.g., Transfer of Property Act 1882, Indian Contract Act 1872">
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn-primary" id="generateBtn">Generate Legal Document</button>
                <button class="btn-secondary" id="clearBtn">Clear Form</button>
            </div>

            <div class="loading" id="loadingIndicator" role="status">
                <div class="spinner"></div>
                <span id="processingText">Processing your request&hellip;</span>
            </div>

            <div class="error-message" id="errorMessage" role="alert"></div>
        </div>

        <!-- RESULT SECTION -->
        <div class="result-section" id="resultSection">
            <div class="result-header">
                <h2 id="resultTitle">Generated Result</h2>
                <button class="btn-readaloud" id="btnReadAloud">&#x1F50A; Read Aloud</button>
                <span class="elevenlabs-badge" id="elBadge" style="display:none;">powered by ElevenLabs</span>
                <button class="copy-btn" id="copyBtn">&#x1F4CB; Copy</button>
                <button class="download-btn" id="downloadWordBtn" disabled>&#x1F4E5; Word</button>
                <button class="download-btn" id="downloadPdfBtn" disabled>&#x1F4E5; PDF</button>
            </div>

            <div id="speakingIndicator">
                <span class="speak-indicator">
                    <span></span><span></span><span></span><span></span><span></span>
                </span>
                <span style="font-size:0.82rem;color:#1a5c2a;font-weight:600;margin-left:8px;">
                    Reading aloud via ElevenLabs&hellip;
                </span>
            </div>

            <div class="result-content" id="resultContent" tabindex="0"></div>
        </div>

    </div>

    <footer>
        <p id="disclaimer"><strong>Disclaimer:</strong> This AI tool provides general legal information and drafts. Always consult a qualified legal professional before acting on any AI-generated content. Not a substitute for professional legal advice.</p>
    </footer>

    <script src="./js/config.js"></script>
    <!-- â”€â”€ LOCALE STYLES & FUNCTIONS (must be after config.js) â”€â”€â”€ -->
    <!-- â”€â”€ LOCALE STYLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <style>
        .locale-btn {
            flex: 1;
            padding: 10px;
            border: 1.5px solid #d4c9a8;
            border-radius: 8px;
            background: transparent;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            color: #5a4e38;
            transition: all 0.2s;
        }
        .locale-btn.active {
            background: linear-gradient(135deg, #8b6914, #c9a84c);
            border-color: #8b6914;
            color: #fff;
        }
        .locale-btn:hover:not(.active) {
            background: rgba(139,105,20,0.1);
        }
    </style>

    <!-- â”€â”€ LOCALE FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <script>
    function setAppLocale(locale) {
        CONFIG.setLocale(locale);
        CONFIG.applyLocale();
        applyTranslations();
        // Update login buttons
        document.querySelectorAll('.locale-btn').forEach(b => b.classList.remove('active'));
        const btnId = locale === 'ja-JP' ? 'localeJP' : 'localeIN';
        const btn = document.getElementById(btnId);
        if (btn) btn.classList.add('active');
        // Update html lang
        const htmlRoot = document.getElementById('htmlRoot');
        if (htmlRoot) htmlRoot.lang = locale === 'ja-JP' ? 'ja' : 'en';
        // Update flag badge in header
        const flag = document.getElementById('localeFlag');
        if (flag) flag.textContent = locale === 'ja-JP' ? 'ðŸ‡¯ðŸ‡µ æ—¥æœ¬' : 'ðŸ‡®ðŸ‡³ India';
    }

    function applyTranslations() {
        const tr = CONFIG.t();
        const isJA = CONFIG.isJapanese();

        // Static text
        const set = (id, val) => { const el = document.getElementById(id); if (el && val) el.innerHTML = val; };
        const setph = (id, val) => { const el = document.getElementById(id); if (el && val) el.placeholder = val; };

        set('appSubtitle',         tr.appSubtitle);
        set('howToTitle',          tr.howToTitle);
        set('selectService',       tr.selectService);
        set('modeContractTitle',   tr.modes.contract.title);
        set('modeContractDesc',    tr.modes.contract.desc);
        set('modeResearchTitle',   tr.modes.research.title);
        set('modeResearchDesc',    tr.modes.research.desc);
        set('modeOpinionTitle',    tr.modes.opinion.title);
        set('modeOpinionDesc',     tr.modes.opinion.desc);
        set('contractTypeLabel',   tr.contractTypeLabel);
        set('contractDetailsLabel',tr.contractDetailsLabel);
        set('legalIssueLabel',     tr.legalIssueLabel);
        set('researchQueryLabel',  tr.researchQueryLabel);
        set('jurisdictionLabel',   tr.jurisdictionLabel);
        set('opinionTopicLabel',   tr.opinionTopicLabel);
        set('opinionQueryLabel',   tr.opinionQueryLabel);
        set('generateBtn',         tr.generateBtn);
        set('clearBtn',            tr.clearBtn);
        set('copyBtn',             tr.copyBtn);
        set('downloadWordBtn',     tr.wordBtn);
        set('downloadPdfBtn',      tr.pdfBtn);
        set('resultTitle',         tr.resultTitle);
        set('disclaimer',          tr.disclaimer);
        set('loginTitle',          tr.loginTitle);
        set('countryLabel',        tr.countryLabel);
        set('chatSubtitle',        tr.chatSubtitle);
        set('applicableLawsLabel',  tr.applicableLawsLabel);
        set('processingText',       tr.processing);
        setph('applicableLawsInput', tr.applicableLawsPlaceholder);
        setph('chatInput',           tr.chatPlaceholder);

        setph('loginEmail',        tr.loginEmailPh);
        setph('loginPassword',     tr.loginPasswordPh);
        setph('contractDetails',   tr.contractDetailsPlaceholder);
        setph('legalIssue',        tr.legalIssuePlaceholder);
        setph('researchQuery',     tr.researchQueryPlaceholder);
        setph('opinionTopic',      tr.opinionTopicPlaceholder);
        setph('opinionQuery',      tr.opinionQueryPlaceholder);
        setph('chatInput',         tr.chatPlaceholder);

        // Mic buttons
        document.querySelectorAll('.btn-mic-inline').forEach(b => {
            if (!b.classList.contains('recording')) b.textContent = tr.speakBtn;
        });

        // Contract type options
        const ctSelect = document.getElementById('contractType');
        if (ctSelect) {
            const selected = ctSelect.value;
            ctSelect.innerHTML = `<option value="">${tr.contractTypePlaceholder}</option>` +
                tr.contractTypes.map(t => `<option value="${t}">${t}</option>`).join('');
            ctSelect.value = selected;
        }

        // Jurisdiction options
        const jurSelect = document.getElementById('jurisdiction');
        if (jurSelect) {
            const selected = jurSelect.value;
            jurSelect.innerHTML = tr.jurisdictions.map((j,i) => `<option value="${j}">${j}</option>`).join('');
            jurSelect.value = selected || tr.jurisdictions[0];
        }

        // How to list
        const howToList = document.querySelector('.info-box ul');
        if (howToList && tr.howTo) {
            howToList.innerHTML = tr.howTo.map(item => `<li>${item}</li>`).join('');
        }

        // Login button text
        set('loginBtn', tr.loginBtn);

        // Chat panel subtitle
        const chatSub = document.getElementById('chatSubtitle');
        if (chatSub) chatSub.textContent = tr.chatSubtitle || '';

        // Update active mode section titles if a mode is selected
        if (CONFIG.currentMode) {
            const cfg = CONFIG.TITLES[CONFIG.currentMode];
            if (cfg) {
                const sectionTitle = document.getElementById('sectionTitle');
                if (sectionTitle) sectionTitle.textContent = cfg.section;
                const genBtn = document.getElementById('generateBtn');
                if (genBtn) genBtn.textContent = cfg.button;
            }
        }
    }

    // Apply saved locale on page load
    document.addEventListener('DOMContentLoaded', () => {
        const saved = CONFIG.getLocale();
        setAppLocale(saved);
    });
    </script>

    <script src="./js/prompts.js"></script>
    <script src="./js/api.js"></script>
    <script src="./js/ui.js"></script>
    <script src="./js/voice.js"></script>
    <script src="./js/app.js"></script>

    <!-- â•â• CHAT ASSISTANT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

    <!-- Floating trigger button -->
    <button id="chatTriggerBtn" title="Ask SAMARTHAA">&#x2696;&#xFE0F;</button>

    <!-- Chat panel -->
    <div id="chatPanel">

        <!-- Header -->
        <div class="chat-header">
            <div class="chat-header-avatar">&#x2696;</div>
            <div class="chat-header-info">
                <h4>SAMARTHAA Assistant</h4>
                <p id="chatSubtitle">Indian Legal AI &bull; Voice &amp; Text</p>
            </div>
            <div class="chat-header-actions">
    <button class="chat-icon-btn" id="chatDownloadBtn" title="Download chat as PDF">ðŸ“¥</button>
    <button class="chat-icon-btn" id="chatClearBtn" title="Clear conversation">ðŸ—‘</button>
    <button class="chat-icon-btn" id="chatCloseBtn" title="Close">âœ•</button>
</div>
        </div>

        <!-- Context banner -->
        <div class="chat-context-banner" id="chatContextBanner">
            <div class="chat-context-dot"></div>
            <span class="chat-context-text" id="chatContextText">Document loaded</span>
            <button class="chat-context-clear" id="chatContextClear">&#x2715; Clear</button>
        </div>

        <!-- Messages -->
        <div class="chat-messages" id="chatMessages"></div>

        <!-- Typing indicator -->
        <div class="chat-typing" id="chatTyping">
            <div class="chat-msg-avatar" style="width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,#c9a84c,#a8872e);color:#fff;display:flex;align-items:center;justify-content:center;font-size:0.75rem;">&#x2696;</div>
            <div class="chat-typing-dots">
                <span></span><span></span><span></span>
            </div>
        </div>

        <!-- Input area -->
        <div class="chat-input-area">
            <div class="chat-input-row">
                <textarea id="chatInput" placeholder="Ask about Indian law or your documentâ€¦" rows="1"></textarea>
                <button class="chat-action-btn" id="chatMicBtn" title="Speak your question">&#x1F3A4;</button>
                <button class="chat-action-btn" id="chatSendBtn" title="Send">&#x27A4;</button>
            </div>
            <div class="chat-input-hint">Press Enter to send &bull; Shift+Enter for new line &bull; &#x1F3A4; to speak</div>
        </div>

    </div>

    <script src="./js/chat.js"></script>


</body>
</html>
